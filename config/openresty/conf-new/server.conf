{{> initial.conf}}

http {

    {{> http.conf}}
    
    {{^development}}
    {{> auto-ssl-init.conf}}
    {{/development}}

    server {
        listen 443 ssl {{^disable_http2}}http2{{/disable_http2}};

        server_name {{host}};

        {{^development}}
        {{> auto-ssl.conf}}
        {{/development}}

        {{#development}}
        ssl_certificate  /etc/blot/blot.development.crt;
        ssl_certificate_key /etc/blot/blot.development.key;
        {{/development}}

        {{> blot-site.conf}}
    }

    server {
        listen 80;
        server_name {{host}}; 
        return 301 https://$host$request_uri;
    }

    server {
        listen 80 default_server;
        listen 443 ssl {{^disable_http2}}http2{{/disable_http2}} default_server;

        {{^development}}
        {{> auto-ssl.conf}}
        {{/development}}

        {{#development}}
        ssl_certificate  /etc/blot/blot.development.crt;
        ssl_certificate_key /etc/blot/blot.development.key;
        {{/development}}

        {{> blot-blogs.conf}}

        {{> purge.conf}}
    }    
}