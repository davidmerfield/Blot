# Use a lightweight Node.js image as the base
FROM node:18

# Set the working directory inside the container
WORKDIR /usr/src/benchmark

# Copy only the benchmark-related files into the container
COPY ./package*.json ./

# Install dependencies for the benchmark
RUN npm install

# Copy the rest of the benchmark folder into the container
COPY ./index.js ./
COPY ./wait-for-it.sh ./
COPY ./artillery.yml ./

# Make sure wait-for-it.sh is executable
RUN chmod +x ./wait-for-it.sh

# Default command (can be overridden by docker-compose.yml)
CMD ["sh", "-c", "node index.js"]