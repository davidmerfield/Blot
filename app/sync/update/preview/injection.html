<script type="text/javascript">

// Disable analytics on drafts
window.doNotTrack = 1;

!function(t,e){function n(){if(!a){a=!0;for(var t=0;t<d.length;t++)d[t].fn.call(window,d[t].ctx);d=[]}}function o(){"complete"===document.readyState&&n()}t=t||"docReady",e=e||window;var d=[],a=!1,c=!1;e[t]=function(t,e){return a?void setTimeout(function(){t(e)},1):(d.push({fn:t,ctx:e}),void("complete"===document.readyState?setTimeout(n,1):c||(document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):(document.attachEvent("onreadystatechange",o),window.attachEvent("onload",n)),c=!0)))}}("docReady",window);!function(t){if("object"==typeof exports)module.exports=t();else if("function"==typeof define&&define.amd)define(t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.DiffRenderer=t()}}(function(){return function t(e,i,r){function n(h,o){if(!i[h]){if(!e[h]){var a="function"==typeof require&&require;if(!o&&a)return a(h,!0);if(s)return s(h,!0);throw new Error("Cannot find module '"+h+"'")}var l=i[h]={exports:{}};e[h][0].call(l.exports,function(t){var i=e[h][1][t];return n(i?i:t)},l,l.exports,t,e,i,r)}return i[h].exports}for(var s="function"==typeof require&&require,h=0;h<r.length;h++)n(r[h]);return n}({1:[function(t,e){e.exports=t("./lib/renderer")},{"./lib/renderer":9}],2:[function(t,e){"use strict";function i(t){for(var e=1,i=0,n=0;n<t.length;n++)e=(e+t.charCodeAt(n))%r,i=(i+e)%r;return e|i<<16}var r=65521;e.exports=i},{}],3:[function(t,e){"use strict";function i(){this.store={}}e.exports=i,i.prototype.allocate=function(t){var e=this.store[t];return e&&e.length?e.shift():this.createElement(t)},i.prototype.deallocate=function(t){var e=t.nodeName.toLowerCase();this.store[e]?this.store[e].push(t):this.store[e]=[t]},i.prototype.createElement=function(t){return"#text"==t?document.createTextNode(""):document.createElement(t)}},{}],4:[function(t,e){"use strict";var i=t("./adler32");e.exports=function r(t){var e,n,s,h="";if(!t)return h;if(t.name){h+=t.name,t.text&&(h+=t.text);for(e in t.attributes)h+=e+t.attributes[e];s=t.children}else s=t;for(n in s)h+=r(s[n]);return t.hash=i(h),h}},{"./adler32":2}],5:[function(t,e){"use strict";e.exports=function(t,e){var i,r;if(!t||!e)return t;for(i="string"==typeof e?e.split("."):e,r=0;r<i.length;r++)t=t[i[r]];return t}},{}],6:[function(t,e){"use strict";function i(t){this.node=t}var r=t("./keypath"),n=t("./node");e.exports=i,i.EXCLUDE={length:!0,parent:!0},i.prototype.apply=function(t){for(var e=0;e<t.length;e++){var r=t[e],n=r.path[r.path.length-1];if(!i.EXCLUDE[n]){var s=!1;isNaN(n)||(s=!0,n=Number(n));var h=this[n];h||(h=s?this.children:this.attributes),h.call(this,r,n)}}},i.prototype.text=function(t){var e=t.path.slice(0,t.path.length-1),i=t.values.now,n=r(this.node.children,e);n.setText(i)},i.prototype.children=function(t,e){var s,h,o=t.values.now;if("add"==t.change)if("number"==typeof e)t.path.length>1?(h=t.path.slice(0,t.path.length-1),h.push(e-1),s=r(this.node.children,h)):s=this.node,s.insertAt(e,new n(o,s));else{h=t.path.slice(0,t.path.length-1),s=r(this.node.children,h);for(var a in o)i.EXCLUDE[a]||s.append(new n(o[a],s))}else"remove"==t.change&&("children"==e?(h=t.path.slice(0,t.path.length-1),s=r(this.node.children,h),s.removeChildren()):(h=t.path,s=r(this.node.children,h),s&&s.parent.removeChild(s)))},i.prototype.attributes=function(t,e){var i,n,s=t.values.now;if("add"==t.change)"attributes"==e?(i=t.path.slice(0,t.path.length-1),n=r(this.node.children,i),n.setAttributes(s)):(i=t.path.slice(0,t.path.length-2),n=r(this.node.children,i),n.setAttribute(e,s));else if("update"==t.change)i=t.path.slice(0,t.path.length-2),n=r(this.node.children,i),n.setAttribute(e,s);else if("remove"==t.change)if("attributes"==e){i=t.path.slice(0,t.path.length-1),n=r(this.node.children,i);for(e in t.values.original)n.removeAttribute(e)}else i=t.path.slice(0,t.path.length-2),n=r(this.node.children,i),n.removeAttribute(e)},i.prototype.name=function(t){var e=t.path.slice(0,t.path.length-1),i=r(this.node.children,e),n=t.values.now;i.setName(n)}},{"./keypath":5,"./node":7}],7:[function(t,e){"use strict";function i(t,e){if(this.name=t.name,t.text&&(this.text=t.text),t.attributes&&(this.attributes=t.attributes),t.element&&(this.target=t.element),this.parent=e,t.element||(this.dirty("name",!0),this.text&&this.dirty("text",!0),this.attributes&&this.dirty("attributes",this.attributes)),t.children){this.children=[];for(var r in t.children)"length"!=r&&(this.children[r]=new i(t.children[r],this),this.children[r].dirty()&&this.dirty("children",!0))}}var r=t("./elements-pool"),n=t("./render-queue"),s=new r;e.exports=i,i.prototype.toJSON=function(){var t={name:this.name};if(this.text&&(t.text=this.text),this.attributes&&(t.attributes=this.attributes),this.children){t.children={length:this.children.length};for(var e=0;e<this.children.length;e++)t.children[e]=this.children[e].toJSON()}return t},i.prototype.render=function(){if(this._dirty){if(this.dirty("name")&&(this.target?this.migrate():this.target=s.allocate(this.name),this.dirty("name",null)),this.dirty("children")&&this.children){for(var t=[],e=0;e<this.children.length;e++){var i=this.children[e];if(i.dirty())if(i.dirty("remove"))this.removeChildAt(e),i.dirty("remove",null);else{var r=this.children[e+1];i.render(),this.target.insertBefore(i.target,r&&r.target),t.push(i),i.dirty("insert",null),i.dirty("name",null)}else t.push(i)}t&&(this.children=t),this.dirty("children",null)}if(this.dirty("text")&&this.text&&(this.target.textContent=this.text,this.dirty("text",null)),this.dirty("attributes")){var n=this.dirty("attributes");for(var h in n){var o=n[h];null==o?(delete this.attributes[h],"#text"!=this.name&&this.target.removeAttribute(h)):(this.attributes||(this.attributes={}),this.attributes[h]=o,this.target.setAttribute(h,o))}this.dirty("attributes",null)}}},i.prototype.removeChildAt=function(t){var e=this.children[t];if(e.detach(),e.cleanup(),e.children)for(var i=0;i<e.children.length;i++)e.removeChildAt(i);s.deallocate(e.target),e.unlink()},i.prototype.migrate=function(){this.detach(),this.cleanup();var t=this.target;if(this.target=s.allocate(this.name),"#text"==this.name)this.children=null;else for(this.text=null;t.hasChildNodes();)this.target.appendChild(t.removeChild(t.firstChild));s.deallocate(t),this.dirty("insert",!0)},i.prototype.detach=function(){var t=this.target.parentNode;t&&t.removeChild(this.target)},i.prototype.cleanup=function(){if(this.attributes)for(var t in this.attributes)this.target.removeAttribute(t);this.text&&(this.target.textContent="")},i.prototype.removeChildren=function(){if(this.children){for(var t=0;t<this.children.length;t++)this.children[t].dirty("remove",!0);this.dirty("children",!0)}},i.prototype.removeChild=function(t){t.dirty("remove",!0),this.dirty("children",!0)},i.prototype.unlink=function(){if(this.children)for(var t=0;t<this.children.length;t++)this.children[t].unlink();this.name=null,this.text=null,this.attributes=null,this.parent=null,this.children=null,this.target=null},i.prototype.insertAt=function(t,e){this.dirty("children",!0),e.dirty("insert",!0),this.children||(this.children=[]),this.children.splice(t,0,e)},i.prototype.append=function(t){var e=this.children?this.children.length:0;this.insertAt(e,t)},i.prototype.setAttributes=function(t){for(var e in t)this.setAttribute(e,t[e])},i.prototype.setAttribute=function(t,e){if(!this.attributes||this.attributes[t]!=e){var i=this.dirty("attributes")||{};i[t]=e,this.dirty("attributes",i)}},i.prototype.removeAttribute=function(t){this.attributes&&null!=this.attributes[t]&&this.setAttribute(t,null)},i.prototype.setText=function(t){"#text"==this.name&&t!=this.text&&(this.dirty("text",!0),this.text=t)},i.prototype.setName=function(t){t!=this.name&&(this.dirty("name",!0),this.parent.dirty("children",!0),this.name=t)},i.prototype.dirty=function(t,e){if(void 0===e)return this._dirty&&t?this._dirty[t]:this._dirty;if(null===e){if(this._dirty){delete this._dirty[t];for(t in this._dirty)return;this._dirty=null}}else this._dirty||(this._dirty={},n.enqueue(this)),this._dirty[t]=e}},{"./elements-pool":3,"./render-queue":8}],8:[function(t,e){"use strict";var i=e.exports=[];i.enqueue=function(t){i.push(t)},i.empty=function(){i.splice(0)}},{}],9:[function(t,e){"use strict";function i(t){if(!t)throw new TypeError("DOM element required");return this instanceof i?(this.node=null,this.modifier=null,void this.refresh(t)):new i(t)}var r=t("docdiff"),n=t("./keypath"),s=t("./node"),h=t("./modifier"),o=t("./serialize-dom"),a=t("./serialize-html"),l=t("./render-queue"),u=t("./hashify");e.exports=i,i.serializeDom=o,i.serializeHtml=a,i.keypath=n,i.docdiff=r,i.hashify=u,i.start=function(){function t(){i.running&&(i.render(),requestAnimationFrame(t))}i.running=!0,requestAnimationFrame(t)},i.stop=function(){i.running=!1},i.render=function(){if(l.length){for(var t=0;t<l.length;t++)l[t].render();return l.empty(),this}},i.prototype.refresh=function(t){!t&&this.node&&(t=this.node.target),this.node&&this.node.unlink();var e=o(t);return this.node=new s(e),this.modifier=new h(this.node),this},i.prototype.update=function(t){var e=a(t).children;if(!e)return this.node.removeChildren(),this;var i=this.node.toJSON().children||{},n=r(i,e);return this.modifier.apply(n),this}},{"./hashify":4,"./keypath":5,"./modifier":6,"./node":7,"./render-queue":8,"./serialize-dom":10,"./serialize-html":11,docdiff:13}],10:[function(t,e){"use strict";e.exports=function i(t){var e={name:t.nodeName.toLowerCase(),element:t};if("#text"==e.name)return e.text=t.textContent,e;var r=t.attributes;if(r&&r.length){e.attributes={};for(var n=r.length,s=0;n>s;s++)e.attributes[r[s].name]=r[s].value}var h=t.childNodes;if(h&&h.length){e.children={length:h.length};for(var o=h.length,s=0;o>s;s++)e.children[s]=i(h[s])}return e}},{}],11:[function(t,e){"use strict";e.exports=function i(t,e){if(e||(e={name:"root"}),!t)return e;for(var r,n,s,h,o,a,l,u,d,c=0,f=!1,p=!1,m=!1,v=!1,y=!1,g=!1,b=!1,x=!1,A=!1,w={parent:e,name:""};!f;){if(r=t[c],n=" "==r||" "==r||"\r"==r||"\n"==r,s="/"==r,h="<"==r,o=">"==r,a="'"==r||'"'==r,s&&(x=!0),o&&(b=!1),null==r)f=!0;else{if(m)if(b)delete w.name;else if(v||!w.name)if(v=!0,w.name&&n||s)v=!1,w.name||(b=!0,e.parent&&(e=e.parent));else{if(o)return i(t.substr(c+1),x||b?e:w),e;n||(w.name+=r)}else if(y||!u)if(y=!0,null==u&&(u=""),s||u&&n||u&&"="==r)y=!1,u&&(w.attributes||(w.attributes={}),w.attributes[u]="");else{if(o)return i(t.substr(c+1),x||b?e:w),e;n||(u+=r)}else(g||u)&&(null==d&&(d=""),a?g?r==l?(d&&(w.attributes[u]=d),g=!1,u=d=null):d+=r:(g=!0,l=r):g&&(d+=r));else if(h){if(A)return i(t.substr(c),e),e;m=!0}else s&&!g?f=!0:(A=!0,m=!1,w.name||(w.name="#text"),null==w.text&&(w.text=""),w.text+=r);w.name&&!p&&(e.children||(e.children={length:0}),e.children[e.children.length]=w,e.children.length++,p=!0)}o&&(x=!1),++c}return e}},{}],12:[function(t,e){var i=t("./utils"),r=function(t,e){return t.filter(function(t){return-1===e.indexOf(t)})},n=function(t){return function(e){i.isObject(e)?t.primitives=!1:t.documents=!1,Array.isArray(e)&&(t.primitives=!1)}};e.exports=function(t,e){var i={primitives:!0,documents:!0};t.forEach(n(i)),e.forEach(n(i));var s={change:null,now:e,original:t};return i.primitives?(s.change="primitiveArray",s.added=r(e,t),s.removed=r(t,e)):s.change=i.documents?"documentArray":"mixedArray",s}},{"./utils":14}],13:[function(t,e){function i(t,e,i,r,n,s,h,o){this.path=t.concat(e),this.change=i,this.type=r,this.values={},"remove"!==i&&(this.values.now=n),"add"!==i&&(this.values.original=s),"primitiveArray"===r&&(this.values.added=h,this.values.removed=o)}var r=t("./arraydiff"),n=t("./utils");e.exports=function s(t,e,h,o){if(!t||!e)return!1;h||(h=[]),o||(o=[]);var a=Object.keys(e);return a.forEach(function(a){var l=e[a],u=t[a];if(n.isObject(l)&&n.isObject(u))return s(u,l,h.concat(a),o);if(Array.isArray(l)&&Array.isArray(u)){var d=r(u,l);return o.push(new i(h,a,"update",d.change,d.now,d.original,d.added,d.removed))}if(u!==l){var c=void 0===u?"add":"update";o.push(new i(h,a,c,"primitive",l,u))}}),Object.keys(t).forEach(function(e){-1===a.indexOf(e)&&o.push(new i(h,e,"remove","primitive",null,t[e]))}),o}},{"./arraydiff":12,"./utils":14}],14:[function(t,e,i){i.isObject=function(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}},{}]},{},[1])(1)});

  docReady(function() {

      var renderer = new DiffRenderer(document.body);
      var source = new EventSource('{{{streamURL}}}');
          source.onmessage = function(e) {

            // var div = document.createElement('div');
            //     div.style.display = 'none';
            //     div.id = 'blotDraftContainer'

            // div.innerHTML = JSON.parse(e.data);
            // renderer.update(div.innerHTML);
            // DiffRenderer.render();

            // document.body.appendChild(div);
            // console.log('DOM UPDATED!');
            // console.log(e);

            document.body.innerHTML = JSON.parse(e.data);
          };
  });
</script>