<link rel="stylesheet" type="text/css" href="/css/dashboard/pickr/themes/monolith.min.css">
<script type="text/javascript" src="/js/pickr/es5.min.js"></script>

<style type="text/css">
button {background: white;border: 2px solid #ddd;border-radius: 4px;font:inherit;font-size: 14px;line-height: 1.45;margin: 6px 3px 0 0;cursor: pointer;}
button.selected {border:2px solid #0075ff;border-radius: 4px}

div[class^="color-picker-"]:hover {
	background: #fff
}

.pickr {
	z-index: auto;
}

.pcr-app .pcr-selection .pcr-picker {
	z-index: 1;
}

.pcr-app.visible {
	transition: none;
	visibility: visible;
	opacity: 1;
}

.pcr-app[data-theme=monolith] .pcr-selection .pcr-color-chooser,
.pcr-app[data-theme=monolith] .pcr-selection .pcr-color-opacity {
	height: .65em;
	margin-top: .65em;
}

.pcr-app {
	transition: none;
	box-shadow: 0 1.5em 1.5em 0 rgba(0, 0, 0, .1), 0 1em 1em 0 rgba(0, 0, 0, .03);
	border-radius: 0
}

.pcr-app[data-theme=monolith] {
	width: 16rem;
	padding: 1em;
	margin-top: -8px;
	box-shadow: 0 0 1px #000;
}

.pcr-app[data-theme=monolith] .pcr-selection .pcr-color-preview {
	display: none;
}

.color-picker .previous {
	outline: 1px solid rgba(0,0,0,0.2);outline-offset:-1px;margin:0 16px;width:2rem;height:1.25rem;display: block;
}
.pcr-app[data-theme=monolith] .pcr-selection .pcr-color-palette .pcr-palette,
.pcr-app[data-theme=monolith] .pcr-selection .pcr-color-chooser .pcr-slider,
.pcr-app[data-theme=monolith] .pcr-selection .pcr-color-opacity .pcr-slider,
.pcr-app[data-theme=monolith] .pcr-selection .pcr-color-preview .pcr-current-color {
	border-radius: 0;
	outline: 1px solid rgba(0, 0, 0, 0.1);
	outline-offset: -1px;

}

.pcr-app[data-theme=monolith] .pcr-selection .pcr-color-opacity .pcr-slider {
	outline: 1px solid rgba(0, 0, 0, 0.3);
}

.pcr-app .pcr-interaction .pcr-save {
	background: #4285f4;
	flex-grow: 1;
}

.pcr-app .pcr-swatches,
.pcr-app[data-theme=monolith] .pcr-selection .pcr-color-preview .pcr-last-color {
	display: none;
}



/* FONTS */
form[id^="font_picker"] svg {height: 1.5em;display: block;}

.options {display: none;margin:0.5em;border:1px solid #aaa;user-select: none;}

input[id^="show_picker"]:checked ~ .options {display: block;}

label[for^="show_picker"] {padding:0.333em 1em;cursor: pointer;position:relative;border-bottom: 1px solid #ddd;display: block;margin:0;user-select: none;}

label[for^="show_picker"]:hover {background: #fff}

label[for^="show_picker"]:after{
	content: "";
	width: 1em;
	height: 1em;
	position: absolute;
	top:50%;
	margin-top: -0.5em;
	right:1em;
	background:  url('data:image/svg+xml;utf8,%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22utf-8%22%3F%3E%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%2043.764%2030.594%22%3E%3Cpath%20stroke%3D%22%23000%22%20d%3D%22M21.871%2024.621c.236%200%20.408-.172.602-.365L38.092%206.875c.107-.129.193-.215.193-.365%200-.301-.236-.537-.537-.537a.644.644%200%200%200-.387.129l-15.468%2017.23L6.359%206.102c-.064-.086-.236-.13-.365-.13a.528.528%200%200%200-.515.538c0%20.15.107.258.214.386L21.27%2024.3c.193.172.343.322.601.322Z%22%2F%3E%3C%2Fsvg%3E') no-repeat 1rem center;
	background-size: 1em;
}

.filters {
	font-size:12px;
	padding:0.15em 0.5em;user-select: none;
}

.filters label {
	border-radius: 10px;padding: 0.15em 0.5em;
	cursor: pointer;
	color:#666;
}

input[id^="show_all"]:checked ~ .options label[for^="show_all"],
input[id^="show_sans"]:checked ~ .options label[for^="show_sans"],
input[id^="show_serif"]:checked ~ .options label[for^="show_serif"],
input[id^="show_other"]:checked ~ .options label[for^="show_other"],
input[id^="show_mono"]:checked ~ .options label[for^="show_mono"]
{background: #e0e0e0;}

input[id^="show_sans"]:checked ~ .options button:not([data-tag="sans"]),
input[id^="show_mono"]:checked ~ .options button:not([data-tag="mono"]),
input[id^="show_serif"]:checked ~ .options button:not([data-tag="serif"]),
input[id^="show_other"]:checked ~ .options button:not([data-tag="other"])
{display: none;}

.options button {
	width: 100%;
	text-align:left;
	margin:0;
	border-radius:0;
	border:none;outline:none;
	background:#fafafa;border-top: 1px solid #ddd;padding:0.333em 0.5em;
}

.options button:hover{background: #fff}

</style>


	<div class="inputs">
		
	{{#color_schemes.length}}
	<h2>Color scheme</h2>
	<form method="post" style="padding: 0 1rem">
	{{#color_schemes}}
	<button type="submit" class="{{selected}}" name="locals.color_scheme" value="{{key}}">{{label}}</button> 
	{{/color_schemes}}
	</form>
	{{/color_schemes.length}}

{{#colors.length}}
	{{^color_schemes.length}}
		<h2>Colors</h2>
	{{/color_schemes.length}}
	{{/colors.length}}

	{{#colors}} {{> template-editor-color}} {{/colors}}

	
		{{#fonts.length}}
		{{#fonts}} {{> template-editor-font}} {{/fonts}} 
	{{/fonts.length}}


{{#layouts.length}}
		<h2>Layout</h2>
		{{#layouts}}

		{{#isBoolean}}
		{{> template-editor-boolean}}
		{{/isBoolean}}

		{{#isSelect}}
		{{> template-editor-select}}
		{{/isSelect}}

		{{#isRange}}
		{{> template-editor-range}} 
		{{/isRange}}

		{{/layouts}}
{{/layouts.length}}


  {{#show_date_options}}
		<h2>Date format</h2>
		<form
			id="dateSettings"
			method="post"
		>
			{{^hide_dates}}
			{{#displayFormats.length}}
			<label style="padding:0 1rem">
				<select style="width:257px;font-size:1rem;margin: 16px 0 8px;" id="date_display" name="locals.date_display">
					{{#displayFormats}}
					<option value="{{value}}" {{selected}}>{{date}}</option>
					{{/displayFormats}}
				</select>
			</label>
			{{/displayFormats.length}}
			{{/hide_dates}}
			

{{#show_hide_dates}}
			<label style="padding:5px 1rem;border-bottom: 1px solid #eee;display: block;">
				<input type="hidden" value="off" name="locals.hide_dates" />
				{{#hide_dates}}
				<input checked id="hide_dates" type="checkbox" name="locals.hide_dates"
				/>
				{{/hide_dates}}
				{{^hide_dates}}
				<input  id="hide_dates" type="checkbox" name="locals.hide_dates"
				/>
				{{/hide_dates}}
				 Hide dates
			</label>
			{{/show_hide_dates}}
						
			<script type="text/javascript">
				document.querySelectorAll('[type="checkbox"], select').forEach(function(node){
						if (node.style.display === 'none') return;
						let form;
						let parent = node.parentNode;

						while (parent && !form) {
							if (parent.tagName.toLowerCase() === 'form')
								form = parent;
							parent = parent.parentNode;
						}

						node.addEventListener("change", () => {
							form.submit();
						});
				});
			</script>
		</form>
	{{/show_date_options}}

		{{#syntax_themes}}
		{{> template-editor-highlighter}}
		{{/syntax_themes}}

	{{> template-editor-footer}}
</div>

<script type="text/javascript">

Array.from(document.querySelectorAll('form.color-picker')).forEach(form => {

	// Simple example, see optional options for more configuration.
    const pickr = Pickr.create({
        el: form.querySelector('.color-picker-popup'),
        theme: 'monolith', // or 'monolith', or 'nano'
        default: form.querySelector('input.value').value,
        useAsButton: true,
        position: 'bottom-end',
        components: {

            // Main components
            preview: true,
            opacity: true,
            hue: true,

            // Input / output Options
            interaction: {
                // hex: true,
                // rgba: true,
                // hsla: true,
                // hsva: true,
                // cmyk: true,
                input: true,
                // clear: true,
                save: true
            }
        }
    });

	pickr.on('save', (color, instance) => {
        form.querySelector('input.value').value = color.toHEXA().toString();
        fetch(window.location.href, {
            method: "post",
            body: new URLSearchParams(new FormData(form)) // for application/x-www-form-urlencoded
        }).then(function (response) {
            document.getElementById("preview").src += "";
        })

        // close pickr after save
        instance.hide();
    }).on('change', (color, instance) => {
        form.querySelector('.previous').style.background = color.toHEXA();
    });
});





// FONT PICKER

Array.from(document.querySelectorAll('form[id^="font_picker"]')).forEach(function(form){
			
			form.querySelectorAll('input, select, button').forEach(function(node){
				if (node.style.display === 'none') return;
				
				const submitForm = (event) => {
		
					// construct the body based on the single input or button that was clicked
					const body = new URLSearchParams();
					
					body.append(node.name, node.value);
					
					console.log(body.toString());
		
					fetch(window.location.href, { method: "post", body }).then(function (response) {
						document.getElementById("preview").src += "";
					});
		
					// if this was a button, we need to close the picker
					// and replace the innerHTML of show_picker with the new font
					if (node.tagName === 'BUTTON') {
						node.parentNode.parentNode.querySelector('input[id^="show_picker"]').checked = false;
						node.parentNode.parentNode.querySelector('label[for^="show_picker"]').innerHTML = node.innerHTML;
					}
		
					event.preventDefault();
					return false;
				}
		
				// if a button, handle click
				if (node.tagName === 'BUTTON') {
					node.addEventListener('click', submitForm)
					return;
				} else {
					node.addEventListener('change', submitForm)
					return;
				}
			})
		
		});
		
			
		
</script>